define(["jquery","pubsub","shared.main.screen","wcs.utils"],function(m,n,o,s){var e,t=WCS_CONFIG.get("topnav::aemTopNavAccordionEnabled")||!1,l=WCS_CONFIG.get("topnav::aemTopnavStyleContainerEnabled")||!1,i=WCS_CONFIG.get("topnav::topnavOverlayContentEnabled")||!1,a=WCS_CONFIG.get("topnav::topnavMenuBackButtonTextOverrideEnabled")||!1,d=WCS_CONFIG.get("topnav::enableMobileTopNavForTablet")||!1,r=WCS_CONFIG.get("topnav::renderTopNavForVansEU")||!1,c=2<=window.devicePixelRatio&&640<=window.innerWidth&&window.innerWidth<=1024&&d;return(e={defaults:{dataAttr:"menu-button-options",accordionLink:".topnav-accordion .has-children > a",topNavDropdown:".topnav-dropdown",accordion:".topnav-accordion",accordionItem:".topnav-accordion-item",l1ShopAll:'.topnav-accordion-shopall:not(".l2 .topnav-accordion-shopall")',speed:250,easing:"swing",imageGrid:".topnav-dropdown-imagegrid",drilldown:"topnav-drilldown",drilldownMenu:".drilldown-menu",drilldownContainer:".drilldown-container",drilldownBackLink:".drilldown-back-link",drodownWrapper:".topnav-dropdown-wrapper",shopAll:"topnav-accordion-shopall",shopAllLink:"topnav-accordion-shopall-link",mainNavContainer:".mainnav-content",carouselContainer:".carousel-section"},init:function(){var n=this;return n.deferred=m.Deferred(),n.$element=m(n.defaults.accordion),n.metadata=n.$element.data(n.defaults.dataAttr),n.config=m.extend({},n.defaults,n.metadata),n.defaultMenuType="accordion",n.$carouselCollection=m(this.config.carouselContainer),n.$carouselCollection.addClass("hide"),n.$menu=n.$element,n.menuType=n.$menu.data("mobile-menu-type"),n.l2Counter=0,n.l3Counter=0,n.boundToElement=!1,n.$accordion=m(n.config.accordion),n.$mainnav=m(n.config.mainnav),"drilldown"===n.menuType&&(n.$drilldownContainer=n.$menu.find(n.config.drilldownContainer),n.$drilldownMenus=n.$drilldownContainer.find(n.config.drilldownMenu),n.$drilldownRoot=n.$drilldownMenus.filter(".root"),n.$drilldownBackLinks=n.$drilldownContainer.find(n.config.drilldownBackLink),n.enableDrilldownMenu()),n.events(),n.handleWhatsTheStyleContentPosition(),n.menuStatus="inactive",n.deferred.resolve(),t&&n.removeTooltip(),i&&n.setupOverlayEffect(),n},events:function(){var i=this;m(i.config.accordionLink).on("click touch",m(this),function(n){m(".custom-highlights").removeClass("custom-highlights"),i.setCarouselCollectionVisibility(m(this).parent().find(i.config.drilldownMenu).first()),"small"!==o.size()&&!c||(n.preventDefault(),m(this).parent().find(".expand-highlights").addClass("custom-highlights"),m(this).hasClass("expand-highlights")||i.toggleMenu(m(this)))}),m.pubsub("subscribe","window.resize.breakpoint",function(n,e){"small"===e.now||c||i.resetMenu(i.$accordion),"drilldown"===i.menuType&&("small"===e.now||c?i.enableDrilldownMenu():i.disableDrilldownMenu()),i.toggleKeyboardMenuEvents(i.$accordion)}),"drilldown"===i.menuType&&i.$drilldownBackLinks.on("click touch",function(n){n.preventDefault(),i.goToPrevMenu()}),i.toggleKeyboardMenuEvents(i.$accordion),m.pubsub("subscribe","vfdp.aem.topnav.accordion.close",function(){i.resetMenu(i.$accordion)}),t&&m("#topnav-menu-button").on("click",function(n){i.setDrilldownHeight()})},setupOverlayEffect:function(){var e=m("#body-container"),n=m(".l1.topnav-accordion-item");e.addClass("overlay-enabled"),n.on("mouseover",function(n){m(this).hasClass("has-children")&&e.addClass("overlay-active")}).on("mouseout",function(n){e.removeClass("overlay-active")})},removeTooltip:function(){m(".topnav-accordion-item-link").removeAttr("title"),m(".topnav-utility-item-link").removeAttr("title"),m(".topnav-utility-item--flag-link").removeAttr("title")},toggleKeyboardMenuEvents:function(n){var e=this;n.off("keydown",e,e.topnavMenuKeyDownHandler),e.boundToElement=!1,"small"!==o.size()&&!c||(n.on("keydown",e,e.topnavMenuKeyDownHandler),e.boundToElement=!0)},toggleMenu:function(n){n.parent().hasClass("active")?this.hideMenuLinks(n):(t?m("#topnav-accordion").addClass("topnav-accordion-top"):m("#topnav-accordion").removeClass("topnav-accordion-top"),this.showMenuLinks(n))},showMenuLinks:function(n){var e,i=this,o=n.parent(),t=o.get(0),l=0;if("drilldown"!==i.menuType){e=n.closest("li").hasClass("l1")?o.find(i.config.topNavDropdown):n.siblings(),n.attr({"aria-expanded":"true"});var a=function(){e.height("auto").addClass("active"),o.height("auto"),t.removeEventListener("transitionend",a)};t.addEventListener("transitionend",a),s.interruptTransitions(o,function(){o.css({height:0,overflow:"hidden",display:"block"}).addClass("active"),e.css({display:"block"}),l=t.scrollHeight}),t.style.height=l+"px"}else i.goToNextMenu(o.find(i.config.drilldownMenu).first())},hideMenuLinks:function(n){var e,i=(e=n.closest("li").hasClass("l1")?n.closest(".l1"):n.closest(".l2")).get(0),o=i.scrollHeight,t=n.height()+2*parseInt(n.parent().css("padding-top"));n.attr({"aria-expanded":"false"});var l=function(){e.find(".active").css({display:"",height:"",overflow:""}).removeClass("active"),e.removeClass("active").css({display:"",height:"",overflow:""}),i.removeEventListener("transitionend",l)};requestAnimationFrame(function(){s.interruptTransitions(e,function(){i.style.height=o+"px"}),requestAnimationFrame(function(){i.addEventListener("transitionend",l),i.style.height=t+"px"})})},resetMenu:function(n){var e=this;n.find(".active").css({display:"",height:"","padding-top":""}).removeClass("active"),n.find(e.config.l1ShopAll).css({display:""}),"drilldown"===e.menuType&&e.resetDrilldownMenu()},navigate:function(n,e,i){return 40==i?(m("[tabindex="+e[n]+"]").trigger("focus"),n++):m("[tabindex="+e[--n]+"]").trigger("focus"),n},navigateL1:function(n,e,i,o,t){n.length?n.trigger("focus"):e.find("> a").trigger("focus"),e.hasClass("active")&&(this.hideMenuLinks(o),i.hasClass("active")&&this.hideMenuLinks(t))},collapseDropdown:function(n){this.hideMenuLinks(n),n.closest(".l1").children("a").trigger("focus")},topnavMenuKeyDownHandler:function(n){var e=n.data,i=m(this).find(m(":focus")),o=i.parent(),t=o.hasClass("has-children"),l=40,a=13,s=27,d=32,r=38;switch(n.keyCode){case d:case a:t&&(n.preventDefault(),o.hasClass("active")?e.hideMenuLinks(i):e.showMenuLinks(i));break;case l:n.preventDefault();var c=o.next();if(c.hasClass("more"))c=o.siblings().first();else if(i.hasClass(e.config.shopAllLink))c=o.hasClass(e.config.shopAll)?o.siblings().find(".l3").first():o.closest(e.config.drodownWrapper).find(".l2").first();else if(o.hasClass("l2")&&o.is(":last-child")){var u=o.closest(".columns"),h=u.next();u.is(":last-child")||h.is(":hidden:last-child")?(c=o.closest(e.config.drodownWrapper).find("."+e.config.shopAll+" .columns")).length||(c=u.siblings().first().find(".l2").first()):c=h.find(".l2").first()}else o.hasClass("l3")&&o.is(":last-child")&&((c=o.closest(".l2").find("."+e.config.shopAll)).length||(c=o.siblings().first()));c.find("> a").focus();break;case r:n.preventDefault();var v=o.prev();if(o.hasClass("l1")&&o.is(":first-child"))(v=o.siblings().last()).hasClass("more")&&(v=v.prev());else if(i.hasClass(e.config.shopAllLink))if(o.hasClass(e.config.shopAll))v=o.siblings().find(".l3").last();else{var f=o.closest(e.config.drodownWrapper).find(">.row .columns").last();v=f.find(".l2").last(),f.is(":hidden")&&(v=f.prev().find(".l2").last())}else if(o.hasClass("l2")&&o.is(":first-child")){var p=o.closest(".columns"),g=p.prev();p.is(":first-child")?(v=o.closest(e.config.drodownWrapper).find("."+e.config.shopAll+" .columns")).length||(v=p.siblings().last().find(".l2").last()):v=g.find(".l2").last()}else o.hasClass("l3")&&o.is(":first-child")&&((v=o.closest(".l2").find("."+e.config.shopAll)).length||(v=o.siblings().last()));v.find("> a").focus();break;case s:n.preventDefault();var w=i.closest(e.config.accordionItem+".active");w.length&&(w.find("> a").focus(),e.hideMenuLinks(w))}},enableDrilldownMenu:function(){var n=this;return"small"!==o.size()&&!c||(n.$accordion.addClass(n.config.drilldown),n.resetDrilldownMenu(),n.deferred.resolve()),n.deferred},disableDrilldownMenu:function(){var n=this;return"small"===o.size()||c||(n.$accordion.removeClass(n.config.drilldown),n.resetDrilldownMenu(),n.deferred.resolve()),n.deferred},resetDrilldownMenu:function(){var n=this;n.$drilldownMenus.removeClass("active"),n.$drilldownRoot.attr("data-menu-level",0),n.$drilldownActiveMenu=n.$drilldownRoot,n.setDrilldownHeight(),n.handleWhatsTheStyleContentPosition()},setDrilldownHeight:function(){var n=this;if("small"===o.size()||c){var e=n.$drilldownActiveMenu.data("height");if(!e){if(0===(e=n.$drilldownActiveMenu.outerHeight())){var i=n.$accordion.is(":visible")?null:n.$accordion;e=s.getHiddenElementSize(n.$drilldownActiveMenu,i,r).height}n.$drilldownActiveMenu.data("height",e)}l?m(this.config.mainNavContainer).css({height:e+47}):n.$drilldownContainer.css({height:e})}else n.$drilldownContainer.css({height:""})},goToNextMenu:function(n){var e=this;e.$drilldownActiveMenu=n,e.$drilldownActiveMenu.addClass("active"),e.setDrilldownHeight();var i=parseInt(e.$drilldownRoot.attr("data-menu-level"))+1;if(e.$drilldownRoot.attr("data-menu-level",i),1==i&&!e.$drilldownActiveMenu.attr("data-category")){var o=e.$drilldownActiveMenu.siblings(".topnav-accordion-item-link").text();a&&(o=e.$drilldownActiveMenu.find(".topnav-dropdown-wrapper .drilldown-back-text").first().text()),e.$drilldownActiveMenu.attr("data-category",o),e.$drilldownActiveMenu.find(".topnav-dropdown-l3 .drilldown-back-text").text(o)}t&&m(".topnav-utility-small-container").addClass("hide"),e.handleWhatsTheStyleContentPosition()},goToPrevMenu:function(){var n=this,e=n.$drilldownActiveMenu;n.$drilldownActiveMenu=e.parents(n.config.drilldownMenu).first(),t&&(n.$drilldownActiveMenu.find(".expand-highlights").addClass("custom-highlights"),2===parseInt(n.$drilldownRoot.attr("data-menu-level"))?m("#topnav-accordion").addClass("topnav-accordion-top"):(m("#topnav-accordion").removeClass("topnav-accordion-top"),m(".topnav-utility-small-container").removeClass("hide"))),n.setCarouselCollectionVisibility(n.$drilldownActiveMenu);var i=function(){e.removeClass("active"),n.$drilldownRoot[0].removeEventListener("transitionend",i)};n.$drilldownRoot[0].addEventListener("transitionend",i),n.setDrilldownHeight(),n.$drilldownRoot.attr("data-menu-level",parseInt(n.$drilldownRoot.attr("data-menu-level"))-1),n.handleWhatsTheStyleContentPosition()},handleWhatsTheStyleContentPosition:function(){try{l&&0<m(".whats-your-style-container").length&&(0===parseInt(this.$drilldownRoot.attr("data-menu-level"))?this.$drilldownRoot.css("top","auto"):this.$drilldownRoot.css("top","0px"))}catch(n){console.log(n)}},setCarouselCollectionVisibility:function(n){if(this.$carouselCollection.addClass("hide"),"small"===o.size()||c){var e=n.find(this.config.carouselContainer),i=n.find(this.config.drilldownMenu+" "+this.config.carouselContainer);e.not(i).removeClass("hide")}}}).init(),e});
//# sourceMappingURL=../../../maps/js/cms/nav/topnavAccordion.hash-f4185a7c02c2a13f01c9ff6617bd94e7.js.map