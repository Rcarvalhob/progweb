define(["jquery","pubsub","shared.main.screen","autocomplete.base","shared.main.scroll","search-autosuggest-helpers"],function(a,e,n,t){"use strict";var s="searchAutoSuggest",r=WCS_CONFIG.get("topnav::aemTopnavNewDesignEnabled")||!1,o=WCS_CONFIG.get("ANALYTICS::pdpDatalayerSuggestedSearchEventEnabled")||!1,i=!1;function u(e,t){this.pluginID=s,this.element=e,this.$element=a(this.element),this.$searchForm=this.$element.is("form")?this.$element:this.$element.closest("form"),this.$searchInput=this.$element.find(".header-search-term-input-js, .topnav-search-input"),this.metadata=this.$element.data("options"),this.$searchContainer=null,this.$resultsContainer=null,this.$instructions=a("#search-autocomplete-instruct"),this.$liveregion=a("#search-autocomplete-live-text"),this.liveregionText=this.$liveregion.data("liveText")?this.$liveregion.data("liveText").trim():"results for",this.resultsDisplayed=!1,this.options=t||{},this.keys={down:40,enter:13,esc:27,left:37,right:39,space:32,tab:9,up:38},this.searchAutoSuggestInit()}u.defaults=(u.prototype={defaults:{action:"after",topnav:".topnav-header",resultsId:"search-autocomplete-results",resultsContainer:".autosuggest-results-container",numsuggestions:7,numfeatured:3,highlightTerm:!1,hasTopSearches:!1,topSearchesText:"Top Searches :",searchAllText:"Search All :",displayKeywordsText:!0,quotesOnTextResults:!0,commaSeparated:!1,displayFeaturedResultsTextHeader:!0,hasFeaturedResults:!0,featuredResultsText:"Featured Results :",activeClass:"autosuggest-active",overlayClass:"autosuggest-overlay",priceDisplay:"offer-only",searchTerm:".search-term-js",closeBtn:".autosuggest-overlay-close",promoContainer:".topnav-promobar-innercontainer"},searchAutoSuggestInit:function(){this.$window=a(window),this.$body=a("body"),this.$topnav=a(this.defaults.topnav),this.$topnav.closest(".transperant-topnav").length&&(i=!0),this.searchAutoSuggestEvents()},build:function(){var s=this;"html.search-autosuggest.expanded"===s.config.template&&(s.config.expandedView=!0,s.config.searchContainer=".topnav"),"small"===n.size()&&s.config.expandedView&&s.enableResultsOverlay(),s.$searchContainer=a(s.config.searchContainer)||null,s.$searchContainer[s.config.action]('<div id="'+s.config.resultsId+'" class="'+s.config.resultsContainer.replace(".","")+' hide"></div>'),o&&a("#"+s.config.resultsId).click(function(e){(0<a(e.target).parents(".autosuggest-results__featured-results-item").length||0<a(e.target).parents(".autosuggest-results__suggestions-list").length)&&window.localStorage.setItem("suggestedProductClicked",!0)}),s.searchAutoSuggestWindowResizeEventToken=a.pubsub("subscribe","window.resize.breakpoint",function(e,t){s.handleWindowResize(t)}),s.$promoContainer=a(s.config.promoContainer)},enableResultsOverlay:function(){this.$body.addClass(this.config.overlayClass)},disbleResultsOverlay:function(){this.$body.removeClass(this.config.overlayClass)},positionContainer:function(){var e=this;e.config.expandedView?"small"===n.size()?e.$resultsContainer.css("top",""):r&&!i?e.$resultsContainer.css("top",e.$topnav.outerHeight()):e.$resultsContainer.css("top",e.$topnav.outerHeight()+e.$promoContainer.outerHeight()):e.$resultsContainer.css("top",e.$searchContainer.innerHeight())},render:function(e){var t=this,s=t.formatData(e);if(s.config=t.config,s.suggestions.length||s.products.length){if(t.$resultsContainer=t.$resultsContainer||a(t.config.resultsContainer),t.$resultsContainer.html(t.compiledTemplate(s)),t.positionContainer(),a.pubsub("unsubscribe",t.searchAutoSuggestStickyEventToken),t.searchAutoSuggestStickyEventToken=a.pubsub("subscribe","vfdp.topnav.sticky",function(){t.positionContainer()}),t.$resultsContainer.removeClass("hide"),t.$searchInput.attr({"aria-expanded":"true"}),t.resultsDisplayed=!0,t.config.expandedView&&t.$body.addClass(t.config.activeClass),!this.config.expandedView&&this.$topnav.hasClass("sticky")){var n=this.$window.height()-this.$resultsContainer.offset().top;this.$resultsContainer.css({"max-height":n,"overflow-y":"auto"})}t.$liveregion.html((s.products.length<t.config.numfeatured?s.products.length:t.config.numfeatured)+" "+t.liveregionText+' "'+s.term+'"'),t.trapFocus(),t.$resultsContainer.on("keydown.search.results",t,t.searchResultsKeydownHandler)}else t.clearDisplay()},trapFocus:function(){var e=this,t=e.$resultsContainer.find(e.defaults.closeBtn),s=e.$resultsContainer.find("[href]").last();t.on("focusout",function(e){a(e.relatedTarget).closest(".autosuggest-results-container").length||s.focus()}),s.on("focusout",function(e){a(e.relatedTarget).closest(".autosuggest-results-container").length||t.focus()})},formatData:function(e){return{term:e.term,suggestions:this.formatSuggestions(e),products:this.formatProducts(e)}},formatSuggestions:function(e){return e.response&&e.response.suggestions&&e.response.suggestions.length?e.response.suggestions.map(function(e,t){return{keyword:e.keyword?e.keyword:e.dq?e.dq:""}}):e.suggestionGroups&&e.suggestionGroups.length&&e.suggestionGroups[0].querySuggestions&&e.suggestionGroups[0].querySuggestions.length?e.suggestionGroups[0].querySuggestions.map(function(e,t){return{keyword:e.displayText?e.displayText:""}}):[]},formatProducts:function(e){var s=this;return e.response&&e.response.products&&e.response.products.length?e.response.products.map(function(e,t){return{label:e.label?e.label:e.title?e.title:"",category:e.category?e.category:"",price:s.formatPrice(e.sale_price?e.sale_price:e.price?e.price:""),list_price:s.formatPrice(e.list_price?e.list_price:e.price?e.price:""),image:e.image?e.image:e.autosuggest_image_url?e.autosuggest_image_url:e.thumb_image?e.thumb_image:"",url:e.autosuggest_pdp_link?e.autosuggest_pdp_link:e.url?e.url:""}}):e.suggestionGroups&&e.suggestionGroups.length&&e.suggestionGroups[0].searchSuggestions&&e.suggestionGroups[0].searchSuggestions.length?e.suggestionGroups[0].searchSuggestions.map(function(e,t){return{label:e.title?e.title:"",category:e.category?e.category:"",price:s.formatPrice(e.sale_price?e.sale_price:""),list_price:s.formatPrice(e.price?e.price:""),image:e.thumb_image?e.thumb_image:"",url:e.url?e.url:""}}):[]},formatPrice:function(e){if("number"!=typeof e)return e;var t=a('meta[name="locale"]').attr("content").replace("_","-").toLowerCase(),s=WCS_CONFIG.get("global::currencyCode"),n=WCS_CONFIG.get("global::currencySymbol");if(!s||!t||!n)return e;var r=Intl.NumberFormat.supportedLocalesOf(t);if(!r.length)return e;var o={style:"currency",currency:s,currencyDisplay:s===n?"code":"symbol"};return new Intl.NumberFormat(r[0],o).format(e)},searchAutoSuggestEvents:function(){var t=this;a(document).on("click",t.defaults.closeBtn,function(){t.clearDisplay(),t.$searchInput.val("").focus()}),document.addEventListener("click",function(e){if(a(e.srcElement).hasClass("s7button"))return!1;t.handleDocumentClick(e)}),t.$searchInput.on("keydown.search.input",function(e){switch(e.keyCode){case t.keys.esc:e.preventDefault(),t.clearDisplay(),t.$searchInput.val("").focus();break;case t.keys.down:case t.keys.tab:t.resultsDisplayed&&(e.preventDefault(),t.$resultsContainer.find(t.defaults.closeBtn).focus())}})},handleDocumentClick:function(e){var t=a(e.target);if((!this.config.expandedView||"small"!==n.size())&&(0<t.closest(this.$resultsContainer).length||t.is(this.$resultsContainer)))return!1;this.clearDisplay()},clearDisplay:function(){var e=this;a(e.config.resultsContainer).off("keydown.search.results",e,e.searchResultsKeydownHandler).addClass("hide").empty(),e.resultsDisplayed=!1,e.$searchInput.attr({"aria-expanded":"false"}),this.$body.removeClass(this.config.activeClass),a.pubsub("unsubscribe",e.searchAutoSuggestStickyEventToken)},handleWindowResize:function(e){this.clearDisplay(),"small"===e.now&&this.config.expandedView?this.enableResultsOverlay():this.disbleResultsOverlay()},searchResultsKeydownHandler:function(e){var t=e.data;e.keyCode==t.keys.esc&&(t.clearDisplay(),t.$searchInput.val("").focus())}}).defaults,u.prototype=a.extend(!0,{},t.prototype,u.prototype),a.fn.searchAutoSuggest=function(t){return this.each(function(){var e=a(this).data(s);e||(e=new u(this,t).init(),a(this).data(s,e))})}});
//# sourceMappingURL=../../../maps/js/shared/search-autosuggest/search-autosuggest.hash-dd6b0361a6be615b1c4a2dce51b54e22.js.map