define(["jquery","pubsub","shared.main.screen","jquery.hoverintent","shared.lazyload","wcs.utils"],function(y,n,t,o,e,d){var a,i=!1,c=WCS_CONFIG.get("topnav::promoBarTopEnabled")||!1,p=WCS_CONFIG.get("topnav::renderTopNavForVansEU")||!1,s=WCS_CONFIG.get("topnav::aemTopnavNewDesignEnabled")||!1,r=WCS_CONFIG.get("topnav::topNavrateHoverLimit")||150,l=WCS_CONFIG.get("topnav::rateHoverLimitAnimationEnabled")||!1,f=WCS_CONFIG.get("topnav::enableMobileTopNavForTablet")||!1,m=2<=window.devicePixelRatio&&640<=window.innerWidth&&window.innerWidth<=1024&&f;return(a={defaults:{el:".topnav-mainnav",dataAttr:"topnav-dropdown-options",dropdown:".topnav-dropdown",dropdownL3:".topnav-accordion-l3-dropdown",dropdownCloseButton:"topnav-dropdown-close",dropdownLink:".l1.has-children:not('.topnav-list, .more') > a",dropdownItem:".l1.has-children:not('.topnav-list, .more')",item:".topnav-accordion-item",itemLink:".topnav-accordion-item-link",l1Item:".l1:not('.topnav-list, .more')",l1MoreItem:".l1.topnav-accordion-item.more.active",l1TopNavListItem:".l1.topnav-accordion-item.topnav-list.active",l1ItemActive:".l1.active:not('.topnav-list, .more')",promoColumn:"topnav-column-promo",topnavHeader:".topnav-header",topnavPromobar:".topnav-promobar",shopAll:"topnav-accordion-shopall",stickyMed:".sticky-medium",rateLimit:r,topnav:".topnav",dropdownWrapper:".topnav-dropdown-wrapper",placeholderLink:".topnav-accordion-item-link.placeholder",lazyLoadImages:"picture.lazy-load",topNavNewHeader:".top-nav-header"},init:function(){var n=this;return n.deferred=y.Deferred(),n.menuStatus="inactive",n.$element=y(n.defaults.el),n.metadata=n.$element.data(n.defaults.dataAttr),n.config=y.extend({},n.defaults,n.metadata),n.config.$header=n.$element,n.config.$topnav=n.config.$header.closest(n.config.topnav),n.$dropdown=n.$element.find(n.config.dropdown),n.$dropdownItem=n.$element.find(n.config.dropdownItem),n.$l3Containers=y(n.config.dropdownL3),n.$l3Controllers=n.$l3Containers.siblings(n.config.itemLink),n.$dropdown.find("."+n.config.promoColumn+" a").addClass(n.config.promoColumn+"-link"),n.events(),n.configureAriaTags(),n.setColumnOrder(t.size()),y.pubsub("publish","vfdp.aem.topnav.dropdown.loaded"),n.deferred.resolve(),n.config.$topnav.closest(".transperant-topnav").length&&(i=!0),n},events:function(){var e=this;e.checkForVisibleDropdowns(),e.toggleMenuStatus(e.$element),y.pubsub("subscribe","window.resize.breakpoint",function(n,o){e.configureAriaTags(),e.setColumnOrder(t.size()),e.hideDropdown(e.$dropdownItem),e.toggleL1KeyboardMenuEvents(y(e.config.l1Item))}),y.pubsub("subscribe","vfdp.aem.topnav.moreMenu.remove.dropdown",function(n,o){e.bindDropdownMenuEvents(o)}),y.pubsub("subscribe","vfdp.aem.topnav.moreMenu.add.dropdown",function(n,o){e.unbindDropdownMenuEvents(o)}),e.bindDropdownMenuEvents(y(e.config.l1Item)),e.toggleL1KeyboardMenuEvents(y(e.config.l1Item)),y("."+e.config.dropdownCloseButton).on("click touch",function(n){n.preventDefault(),e.menuStatus="inactive",e.animateClosed(y(this).closest(".l1"))}),y.pubsub("subscribe","vfdp.aem.topnav.moreDropdown.opened",function(){e.hideDropdown(e.$dropdownItem)}),y(e.config.placeholderLink).on("click",function(n){n.preventDefault()})},unbindDropdownMenuEvents:function(n){n.off("mouseenter mouseleave"),n.find("> a").off("tap"),n.off("keydown")},toggleL1KeyboardMenuEvents:function(n){n.off("keydown"),"small"!==t.size()&&n.on("keydown",this,this.topnavMenuKeyDownHandler)},bindDropdownMenuEvents:function(n){var e=this;n.hoverIntent({over:function(){"small"===t.size()||m||("inactive"===e.menuStatus&&n.hasClass("has-children")&&!y(this).hasClass("active")?e.animateOpen(y(this)):e.showDropdown(y(this)))},out:function(){},timeout:e.config.rateLimit}),n.find("> a").on("tap",function(n){var o=y(this).closest(e.config.dropdownItem);"small"!==t.size()&&!m&&y(this).closest(".l1").hasClass("has-children")&&(n.preventDefault(),o.hasClass("active")?e.animateClosed(o):y(e.config.l1Item).hasClass("active")?e.showDropdown(o):e.animateOpen(o))})},configureAriaTags:function(){var n=this;"small"!==t.size()?(n.$l3Containers.each(function(){var n=y(this);n.attr({"data-labelledby":n.attr("aria-labelledby")}).removeAttr("aria-labelledby")}),n.$l3Controllers.each(function(){var n=y(this);n.attr({"data-expanded":n.attr("aria-expanded"),"data-controls":n.attr("aria-controls"),"data-haspopup":n.attr("aria-haspopup")}).removeAttr("aria-expanded aria-controls aria-haspopup")})):(n.$l3Containers.each(function(){var n=y(this);n.attr({"aria-labelledby":n.attr("data-labelledby")}).removeAttr("data-labelledby")}),n.$l3Controllers.each(function(){var n=y(this);n.attr({"aria-expanded":n.attr("data-expanded"),"aria-controls":n.attr("data-controls"),"aria-haspopup":n.attr("data-haspopup")}).removeAttr("data-expanded data-controls data-haspopup")}))},setColumnOrder:function(e){this.$dropdown.find(".columns").each(function(){var n=y(this),o=n.data("order-"+e);void 0!==o&&n.css("order",o)})},animateOpen:function(n){var o=this,e=n.find(">"+o.config.itemLink),t=n.find(o.config.dropdown),a=0,i=t[0],s=y(o.config.topnavPromobar)[0],r=function(){i.style.height="",i.removeEventListener("transitionend",r)};if(o.hideDropdown(n.siblings(o.config.dropdownItem)),y(o.config.topnavPromobar).hasClass("notransition")&&y(o.config.topnavPromobar).removeClass("notransition"),p&&n.hasClass("has-children")&&o.generateFullBleedElements(n),n.hasClass("active")||!n.hasClass("has-children"))return!0;var l=t.add(o.config.topnavPromobar);d.interruptTransitions(l,function(){o.toggleTransperantTopNav("show"),n.addClass("active"),t.css({display:"block",height:"0"}),y(o.config.topnavHeader).hasClass("sticky-minimized")&&y(o.config.topnavPromobar).removeClass("hide"),a=i.scrollHeight}),i.addEventListener("transitionend",r),e.attr({"aria-expanded":"true"}),y(document).on("click touchstart scroll",o,o.topnavDismiss),i.style.height=a+"px",c||(s.style.top=a+"px"),y.pubsub("publish","vfdp.aem.topnav.dropdown.animate.opened")},calculateFlyoutFullBleed:function(n){var o=(y(window).width()-y(".topnav").width())/-2;n.find(".topnav-dropdown").css("marginLeft",o)},generateFullBleedElements:function(o){var e=this;o.hasClass("has-children")&&(o.addClass("full-bleed"),e.calculateFlyoutFullBleed(o),y(window).on("resize",function(n){e.calculateFlyoutFullBleed(o)}))},toggleTransperantTopNav:function(n){var o=y(this.config.topNavNewHeader);i&&(document.querySelector(this.config.l1MoreItem)||document.querySelector(this.config.l1TopNavListItem)||("show"==n?o.addClass("new-transperant-topnav"):o.removeClass("new-transperant-topnav")))},animateClosed:function(n){var o,e=this,t=n.find(">"+e.config.itemLink),a=n.find(e.config.dropdown),i=a[0],s=y(e.config.topnavPromobar)[0],r=function(){i.style.display="",i.style.height="",a.closest(".l1").removeClass("active"),e.toggleTransperantTopNav("hide"),y(e.config.topnavHeader).hasClass("sticky-minimized")&&!c?y(e.config.topnavPromobar).addClass("hide"):y(e.config.topnavPromobar).css({top:""}),i.removeEventListener("transitionend",r)};y(e.config.topnavPromobar).hasClass("notransition")&&y(e.config.topnavPromobar).removeClass("notransition"),o=i.scrollHeight,t.attr({"aria-expanded":"false"}),y(document).off("click touchstart scroll",e,e.topnavDismiss),requestAnimationFrame(function(){var n=a.add(e.config.topnavPromobar);d.interruptTransitions(n,function(){i.style.height=o+"px",c||(s.style.top=o+"px")}),requestAnimationFrame(function(){i.addEventListener("transitionend",r),i.style.height="0px",s.style.top="0px"})})},checkForVisibleDropdowns:function(){var n=this,o=y(n.config.dropdown+":visible");0<o.length?(o.closest(n.config.dropdownItem).one("mouseleave",function(){n.$element.removeClass("topnav-mainnav-no-js")}),n.$element.one("mouseleave",n,n.dropdownDismissHandler)):n.$element.removeClass("topnav-mainnav-no-js")},dropdownDismissHandler:function(n){var o=n.data,e=y(n.target);e.is(o.$element)||e.is(o.config.dropdownWrapper)||e.is(o.config.topnavPromobar)||o.$dropdownItem.hasClass("active")&&(o.animateClosed(y(o.config.l1ItemActive)),o.menuStatus="inactive")},toggleMenuStatus:function(n){function o(n){var o=n.data;y(".l1.more").hasClass("hide")&&o.$dropdownItem.hasClass("active")&&(y(n.target)!==y(n.currentTarget)&&!y(n.target).is(o.$element)||(l?setTimeout(function(){o.animateClosed(y(o.config.l1ItemActive)),o.menuStatus="inactive"},o.config.rateLimit):(o.hideDropdown(y(o.config.l1ItemActive)),o.menuStatus="inactive")))}var e=this;n.hoverIntent({over:function(n){"small"!==t.size()&&(e.menuStatus="active",e.$dropdownItem.hasClass("active")&&(y(this).one("mouseleave",e,e.dropdownDismissHandler),y(this).on("mousemove",e,o)))},out:function(){"small"!==t.size()&&(e.menuStatus="inactive",y(this).off("mousemove",e,o))},timeout:e.config.rateLimit}),n.closest(e.config.topnavHeader).hoverIntent({over:function(n){"small"!==t.size()&&y(this).find(e.config.lazyLoadImages).lazyload()},out:function(){"small"!==t.size()&&e.$dropdownItem.hasClass("active")&&(e.animateClosed(y(e.config.l1ItemActive)),y(this).off("mousemove",e,o),y(this).off("mouseleave",e,e.dropdownDismissHandler),e.menuStatus="inactive")},timeout:e.config.rateLimit})},hideDropdown:function(n){var o=this,e=n.find(">"+o.config.itemLink),t=n.find(o.config.dropdown),a=y(o.config.topnavPromobar);t.css({transition:"",display:"",height:""}),e.attr({"aria-expanded":"false"}),o.toggleTransperantTopNav("hide"),n.removeClass("active"),n.siblings(o.config.dropdownItem).removeClass("active"),y(o.config.topnavHeader).hasClass("sticky-minimized")&&!c&&a.addClass("hide"),a.addClass("notransition").css({top:0}),y(document).off("click touchstart scroll",o,o.topnavDismiss)},showDropdown:function(n){var o,e=this,t=n.find(">"+e.config.itemLink),a=n.find(e.config.dropdown),i=y(e.config.topnavPromobar);e.hideDropdown(n.siblings(e.config.dropdownItem)),n.hasClass("has-children")?(e.toggleTransperantTopNav("show"),n.addClass("active"),a.css({transition:"",display:"block"}),o=a.outerHeight(),y(e.config.topnavHeader).hasClass("sticky-minimized")&&!c&&y(e.config.topnavPromobar).removeClass("hide"),a.css({height:o}),s||i.addClass("notransition").css({top:o}),p&&e.generateFullBleedElements(n)):y(e.config.topnavHeader).hasClass("sticky-minimized")&&!c&&y(e.config.topnavPromobar).addClass("hide"),t.attr({"aria-expanded":"true"}),y(document).on("click touchstart scroll",e,e.topnavDismiss),y.pubsub("publish","vfdp.aem.topnav.dropdown.opened")},topnavDismiss:function(n){var o=n.data;y(n.target).closest(o.config.dropdownItem).length||y(n.target).closest(o.config.dropdown).length||o.hideDropdown(y(o.config.dropdownItem))},addTabIndexToDropdownElements:function(n){var a="a:not(.l2 ."+this.config.shopAll+"-link)";y(n).each(function(n,o){for(var e=y(o).find(a),t=0;t<e.length;t++)y(e[t]).attr("tabindex",t)})},topnavMenuKeyDownHandler:function(n){var o,e,t=n.data,a=y(this),i=a.find(y(":focus")),s=i.parent(),r=s.closest(t.config.dropdownWrapper),l=s.closest(".columns"),d=s.hasClass("has-children"),c=d&&s.hasClass("l1"),p=40,f=13,m=27,u=37,v=39,h=32,g=38;function w(){var n=r.find("> ."+t.config.shopAll+" a");return n.length||(n=r.find("> .row > .columns:first-child").find(".l2").first()),n}function C(n){return o=n.length?n.hasClass(t.config.promoColumn)&&n.find("."+t.config.promoColumn+"-link").length?n.find("."+t.config.promoColumn+"-link").first():n.find(".l2").first():w()}switch(n.keyCode){case h:case f:c?(n.preventDefault(),s.hasClass("active")?t.hideDropdown(a):(t.showDropdown(a),s.find("."+t.config.dropdownCloseButton).focus())):i.hasClass(t.config.dropdownCloseButton)&&(n.preventDefault(),t.hideDropdown(a),i.closest(".l1").find("> "+t.config.itemLink).focus());break;case p:if(n.preventDefault(),c)t.showDropdown(a),s.find("."+t.config.dropdownCloseButton).focus();else{var b=l.next();o=s.next(),i.hasClass(t.config.dropdownCloseButton)?o=w():i.hasClass(t.config.shopAll+"-link")?o=r.find(t.config.item).first():d?o=s.find(".l3").first():s.hasClass("l2")&&s.is(":last-child")?o=C(b):s.hasClass("l3")&&s.is(":last-child")?(o=s.closest(".l2").next()).length||(o=C(b)):i.hasClass(t.config.promoColumn+"-link")&&(s.hasClass("media")&&(o=l.find("."+t.config.promoColumn+"-text a").first()),s.hasClass(t.config.promoColumn+"-text")&&(o=i.next("a")),o.length||(o=w())),o.is("a")?o.focus():o.find("> a").focus()}break;case g:n.preventDefault();var k=l.prev();e=s.prev(),i.hasClass(t.config.shopAll+"-link")?e=r.find("> .row > .columns:last-child a").last():s.hasClass("l2")&&s.is(":first-child")?l.is(":first-child")?(e=r.find(" > ."+t.config.shopAll+" a"),k.length||r.find("> .row > .columns:last-child a").last()):e=k.find("a").last():e.hasClass("has-children")?e=e.find("a").last():s.hasClass("l3")&&s.is(":first-child")?e=s.closest(".l2"):i.hasClass(t.config.promoColumn+"-link")&&(s.hasClass(t.config.promoColumn+"-text")&&(e=i.prev("a")),e.length||s.hasClass("media")||(e=l.find("."+t.config.promoColumn+"-media a")),e.length||(e=k.find("a").last())),e.is("a")?e.focus():e.find("> a").focus();break;case v:n.preventDefault(),s.hasClass("l1")?(o=s.next(":visible").find("> a")).length||(o=t.$element.find(".l1").first().find("> a")):(o=l.next().find("a").first()).length||(o=l.siblings().first().find("a").first()),o.focus();break;case u:n.preventDefault(),s.hasClass("l1")?(e=s.prev().find("> a")).length||(e=t.$element.find(".l1:visible").last().find("> a")):(e=l.prev().find("a").first()).length||(e=l.siblings().last().find("a").first()),e.focus();break;case m:i.closest(".l1").hasClass("active")&&(n.preventDefault(),t.hideDropdown(a),i.closest(".l1").find("> "+t.config.itemLink).focus())}}}).init(),a});
//# sourceMappingURL=../../../maps/js/cms/nav/dropdown.hash-02dbf764385d54e83e420c4374a58b16.js.map