define(["jquery","pubsub","wcs.alert","promise!wcs.zmetrics","datalayer.wcs.mini-list","coremetrics.wcs.mini-list","promise!wcs.lang-msg"],function(N,t,i){var o=!1,m=!1,n=!1,f=0,h=0,H=WCS_CONFIG.get("global::miniCartLocation"),e=0<N(".topnav-header").length,a=WCS_CONFIG.get("global::cmsTopNavRightMiniCart"),d=e&&!1===a||"top"===H;function M(t){t&&!t.globalLoading||(d?i.showLoadingNotification("p"):"right"===H&&i.showLoadingNotificationByPosition("l",".global-cart-wishlist-panels-js"))}function P(){d?i.hideLoadingNotification():"right"===H&&i.hideLoadingNotificationByPosition(".global-cart-wishlist-panels-js")}function r(t,i){var e=t||LANG_MSG.GENERIC_ERROR_MESSAGE;i.container.html('<div class="message error text-center columns">'+e+"</div>")}function s(t){var i,e,a,n,r,s=N(t.target);if("delete"===s.data("action")||"add to cart"===s.data("action")){t.preventDefault();var c=s.parents(".cart-list"),o={title:c.find(".page-title").text(),page:c.data("tabcontent"),container:c},d="add to cart"===s.data("action")?LANG_MSG["DEFAULT_MINICART.MSG.movedToShoppingCart"]:void 0,l=s.parents(".cart-item-js").find(".cart-item-row"),m="";l.find(".item-attr-js.defining").each(function(){m+=(0<m.length?" / ":"")+N(this).text()});var f=l.find(".product-info-js").data("seoCategory"),h=l.find(".product-info-js").data("bundlePartnumber"),u=l.find(".product-info-js").data("itemPartnumber"),p=l.find(".product-info-js").data("masterCategory"),g=l.find(".product-info-js").data("parentProductId"),v=l.find(".product-info-js").data("childProductId"),C=l.find(".product-info-js").data("partNumber"),b=l.find(".product-info-js").data("styleCode"),j=l.find(".item-attr-info-js").data("colorCode"),I=l.find(".item-attr-info-js").data("colorDescription"),y=l.find(".item-attr-info-js").data("size"),w=l.find(".item-price-js").data("unitPrice"),x={currency:WCS_CONFIG.get("global::currencyCode"),productName:l.find(".item-name-js").text().replace(/^\s+|\s+$/gm,""),productId:C||"",unitPrice:w||"",definingAttributes:N.trim(m),quantity:l.find(".item-qty-js").data("qty"),categoryId:"",masterCategoryId:p||"",childPartNumber:u||"",parentProductId:g||"",childProductId:v||"",bundlePartNumber:h||"",seoCategory:f||"",isQuickView:!1,isSearch:!1,styleCode:b||"",colorCode:j||"",colorDescription:I||"",size:y||""};i=s.attr("href"),e=o,a=d,n=s.data("action"),r=x,n=n||"remove",M(e),N.ajax({url:i,type:"POST",dataType:"html",success:function(t){"wishlist"===e.page?(T(t,e,a,n),N.pubsub("publish","WISHLIST_UPDATED.remove",data={product:[{bundleId:r.bundlePartNumber,itemId:r.childPartNumber,name:r.productName,productId:r.productId}]}),"add to cart"===n&&(0<N(".shopcart-js").length&&(window.location.href=N(".btn-shoppingbag-js").attr("href")),orderId&&N.pubsub("publish","vfdp.wcs.mini_list.add_to_cart_succeeded",r))):"shopcart"===e.page&&"delete"===n&&orderId&&"right"===H&&T(t,e,a,n);var i="delete"==n||"remove"==n?"remove":"add";N.pubsub("publish","SHOPCART_UPDATED."+i,{product:[{bundleId:r.bundlePartNumber,itemId:r.childPartNumber,name:r.productName,productId:r.productId}],rewardEligibility:{orderId:orderId,rewardOptionEligible:rewardOptionEligible,rewardsAdded:rewardsAdded},action:n})}}).always(function(t){P()}),"add to cart"===s.data("action")&&(N.pubsub("publish","vfdp.wcs.mini_list.add_to_cart_clicked"),zm.trackAddedItem(x))}}function T(t,i,e,a){function c(t){var i=t.css("top")||"auto";return"auto"==i&&(i="0px"),parseFloat(i.replace(/[^-\d\.]/g,""))}function n(t){var i=N(t.target);if(i.hasClass("cart-item-container-js")||0<i.parents(".cart-item-container-js").length){var e=-t.originalEvent.deltaY,a=Math.max(-1,Math.min(1,e));return a<0?l.container.find(".cart-item-nav.next").hasClass("hide")||l.container.find(".cart-item-nav.next").hasClass("disabled")||l.container.find(".cart-item-nav.next").trigger("click"):0<a&&(l.container.find(".cart-item-nav.prev").hasClass("hide")||l.container.find(".cart-item-nav.prev").hasClass("disabled")||l.container.find(".cart-item-nav.prev").trigger("click")),!1}return!0}var l;i.container.html(t),"add to cart"===a&&i.container.find(".ajax-messaging").html('<p class="message success">'+e+"</p>"),p(l=i),l.container.find(".cart-item-nav.prev").on("click",function(){if(!N(this).hasClass("ready"))return!1;if(N(this).hasClass("disabled"))return!1;var t=c(N(this).closest(".cart-list").find(".cart-item-slide-js")),i=N(this).closest(".cart-list").find(".cart-item").outerHeight(!0);N(this).removeClass("ready"),N(this).closest(".cart-list").find(".cart-item-nav.next").removeClass("disabled"),N(this).closest(".cart-list").find(".cart-item-slide-js").animate({top:"+="+Math.min(-t,i)},300,function(){N(this).closest(".cart-list").find(".cart-item-nav.prev").addClass("ready"),0<=c(N(this).closest(".cart-list").find(".cart-item-slide-js"))&&N(this).closest(".cart-list").find(".cart-item-nav.prev").addClass("disabled")})}).on("keydown",function(t){32!==t.keyCode&&13!==t.keyCode||(t.preventDefault(),N(this).click())}),l.container.find(".cart-item-nav.next").on("click",function(){if(!N(this).hasClass("ready"))return!1;var t,i=l.container.find(".cart-item-slide-js").outerHeight(!1),e=l.container.find(".cart-item-container-js").outerHeight(!0),a=c(N(this).closest(".cart-list").find(".cart-item-slide-js")),n=N(this).closest(".cart-list").find(".cart-item-js").outerHeight(!0);if(i+parseInt(a)<=e)return!1;newTop=i+parseInt(a)-n,t=newTop<=e?n-(e-newTop):n,N(this).removeClass("ready"),N(this).closest(".cart-list").find(".cart-item-nav.prev").removeClass("disabled"),N(this).closest(".cart-list").find(".cart-item-slide-js").animate({top:"-="+t},300,function(){N(this).closest(".cart-list").find(".cart-item-nav.next").addClass("ready");var t=l.container.find(".cart-item-slide-js").outerHeight(!0),i=l.container.find(".cart-item-container-js").outerHeight(!0),e=c(N(this).closest(".cart-list").find(".cart-item-slide-js"));t+parseInt(e)<=i&&N(this).closest(".cart-list").find(".cart-item-nav.next").addClass("disabled")})}).on("keydown",function(t){32!==t.keyCode&&13!==t.keyCode||(t.preventDefault(),N(this).click())}),l.container.find(".cart-item-container-js").on({wheel:n,touchstart:function(t){var i=N(this).closest(".cart-list").find(".cart-item-slide-js");i.stop(),o=!0,f=t.originalEvent.touches[0].clientY,h=c(i)},touchmove:function(t){m=!0,t.preventDefault();var i=N(this).closest(".cart-list").find(".cart-item-slide-js"),e=N(this).closest(".cart-list").find(".cart-item-container-js"),a=i.outerHeight(!0),n=e.outerHeight(!0),r=t.originalEvent.touches[0].clientY-f,s=h+r,c=Math.min(0,n-a),o=l.container.find(".cart-item-nav.prev"),d=l.container.find(".cart-item-nav.next");s<0&&c<s?(i.css("top",s+"px"),o.hasClass("disabled")&&o.removeClass("disabled"),d.hasClass("disabled")&&d.removeClass("disabled")):0<=s?(i.css("top",s/2+"px"),o.hasClass("disabled")||o.addClass("disabled")):s<=c&&(i.css("top",s/2+c/2+"px"),d.hasClass("disabled")||d.addClass("disabled"))},touchend:function(t){if(o&&m){var i=N(this).closest(".cart-list").find(".cart-item-slide-js"),e=N(this).closest(".cart-list").find(".cart-item-container-js"),a=i.outerHeight(!0),n=e.outerHeight(!0),r=n-a,s=c(i);0<s||0<n-a?i.animate({top:"0px"},400):s<n-a&&i.animate({top:r+"px"},400)}m=o=!1,f=t.originalEvent.changedTouches[0].clientY}}),l.container.on({touchmove:function(t){t.preventDefault()}}),N(document).on("mousewheel",n),N(window).on("resize",function(){p(l);var t=l.container.find(".cart-item-slide-js").outerHeight(!0),i=u(l),e=c(l.container.find(".cart-item-slide-js"));t+parseInt(e)<i-50?l.container.find(".cart-item-nav.next").addClass("disabled"):l.container.find(".cart-item-nav.next").removeClass("disabled")}),N.pubsub("publish","MINICART_CONTENT_RENDER_COMPLETE",e)}function u(t){var i=t.container.height(),e=0,a=t.container.find(".content-head"),n=parseInt(a.css("margin-top"),10),r=parseInt(a.css("margin-bottom"),10),s=a.find(".section-title"),c=parseInt(s.css("margin-top"),10),o=s.outerHeight(!1),d=a.find(".page-title"),l=parseInt(d.css("margin-top"),10),m=d.outerHeight(!1),f=t.container.find(".cart-actions, .wishlist-actions").outerHeight(!0),h=0,u=0,p=0,g=t.container.find(".waved-line-sep"),v=parseInt(g.css("margin-top"),10),C=g.outerHeight(!0),b=Math.max(n,c);e=b+o+l+m+r,e=Math.max(b+r,e);var j=t.container.find(".free-shipping-promo"),I=t.container.find(".mini-cart-promo-header");return 0<j.length?(h=parseInt(j.css("margin-top"),10),u=j.outerHeight(!1),p=parseInt(j.css("margin-bottom"),10)):0<I.length&&I.each(function(){var t=N(this);if(0<t.parents(".cart-item-container-js").length)return!1;h=parseInt(t.css("margin-top"),10),u=parseInt(t.parents(".espot-container").outerHeight(!1)),p=parseInt(t.parents(".espot-container").find("p").css("margin-bottom"),10)}),i-e-f-C-(u=h+u+p)+Math.min(p,v)}function p(t){var i=t.container.find(".cart-item-slide-js").outerHeight(!0),e=document.querySelectorAll(".cart-item-js"),a=u(t);if(d){var n=t.container.find(".cart-item-js").length,r=N("#miniCartCustomHead"),s=Array.prototype.map.call(e,function(t){return t.offsetHeight});a=(i=Math.max.apply(Math,s))*Math.min(2,n),0<r.length&&(a+=r.outerHeight(!0)),t.container.find(".cart-item-container-js").css({height:a+"px"}),2<n?t.container.find(".cart-item-nav").hasClass("hide")&&t.container.find(".cart-item-nav").removeClass("hide"):t.container.find(".cart-item-nav").hasClass("hide")||(t.container.find(".cart-item-nav").addClass("hide"),t.container.find(".cart-item-slide-js").css("top",""))}else{var c=0<t.container.find(".mini-cart-action-sticky").length;i<=a?(t.container.find(".cart-item-container-js").css("height",a+"px"),c&&(t.container.find(".mini-cart-item-slide .mini-cart-actions").removeClass("hide"),t.container.find(".mini-cart-action-sticky").addClass("hide")),t.container.find(".cart-item-nav").hasClass("hide")||(t.container.find(".cart-item-nav").addClass("hide"),t.container.find(".cart-item-slide-js").css("top",""))):(t.container.find(".cart-item-container-js").css("height",a-70+"px"),c&&(t.container.find(".mini-cart-action-sticky").removeClass("hide"),t.container.find(".mini-cart-item-slide .mini-cart-actions").addClass("hide")),t.container.find(".cart-item-nav").hasClass("hide")&&t.container.find(".cart-item-nav").removeClass("hide"))}}return N(document).on("click",".mini-cart-action-remove-item-js, .mini-cart-action-add-to-cart-js",function(t){s(t)}),{renderMiniListItems:function(t,i,e,a){if(M(e),!n)return n=!0,N.ajax({url:t,dataType:"html",data:i}).done(function(t){(t=t||[]).includes("errorMessage")?r((t=JSON.parse(t)).errorMessage,e):d?T(t,e,a):T(t,e)}).fail(function(t){t.responseText.includes("errorMessage")&&(t=JSON.parse(t.responseText)),r(t.errorMessage,e)}).always(function(t){P(),n=!1})},initCarousel:p}});
//# sourceMappingURL=../../../maps/js/wcs/view/mini-list.hash-e5f07bfae237a166ac70f6edd1e9fa6c.js.map