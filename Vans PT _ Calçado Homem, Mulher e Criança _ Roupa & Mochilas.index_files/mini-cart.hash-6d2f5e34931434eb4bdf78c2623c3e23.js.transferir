define(["require","jquery","shared.main.screen","wcs.mini-list","wcs.mobile-panel","wcs.context","wcs.alert","handlebars-loader","promise!wcs.lang-msg","pubsub","promise!wcs.zmetrics"],function(n,r,a,c,e,d,i,t){function s(i,t){this.element=i,this.$element=r(i),this.options=t,this.metadata=r(this.element).data("minicart-options")}var o="minicart";s.defaults=(s.prototype={defaults:{wishlistPanel:"#wishlist-notification-panel",topnav:".topnav-header",topnavWrapper:"div.topnav",cartWishlistPanel:".global-cart-wishlist-panels-js, .topnav-minicart-panel",cmsTopNavMiniCart:".topnav-minicart",rightMiniCartPanel:".mini-cart-section.l-right",minicartMessage:{template:"html.mini-cart.messaging",cartPanelNotification:".global-cart-wishlist-panels-js .notification, .topnav-minicart-panel .notification",wishlistPanelNotification:"#wishlist-notification-panel .notification",loadParameters:{target:".global-cart-wishlist-panels-js .notification, .topnav-minicart-panel .notification",pluginFN:"minicartMessage",requireModule:"minicart-message"}}},init:function(){this.config=r.extend({},this.defaults,this.options,this.metadata);var i=this;if(i.isCMSTopNav=i.element===r(i.config.topnavWrapper)[0],i._miniCartLocation=WCS_CONFIG.get("global::miniCartLocation"),i._cmsTopNavRightMiniCart=WCS_CONFIG.get("global::cmsTopNavRightMiniCart"),i.autoHideTime=parseInt(WCS_CONFIG.get("global::miniCartAutoHideTime")),i.mobileShowAsModal=WCS_CONFIG.get("global::miniCartMobileShowAsModal"),i.miniCartMobileTopScrollEnabled=WCS_CONFIG.get("global::miniCartMobileTopScrollEnabled"),i.mobileApplePayButtonEnabled=WCS_CONFIG.get("applePay::applePayPDPMobileCTAEnabled"),i.overlayVisible=!1,i.manuallyClosed=!1,i.disableMiniCart=!!r("body").data("disableMiniCart")&&r("body").data("disableMiniCart"),i.isSmallScreen=function(){return"small"===a.size()},i.notificationTimer="",i._build(),i.isTopMiniCart="top"===i._miniCartLocation||i.isCMSTopNav&&!1===i._cmsTopNavRightMiniCart,i.$globalCartWishlistPanels=r(i.config.cartWishlistPanel),i.$miniCartPanels=r("#global-cart-wishlist-panels, .topnav-minicart-panel"),new t(i.config.minicartMessage),r(document).on("click",".continue-shopping-link",function(){r("#global-cart-wishlist-panels").addClass("hide")}),0===r(".shopcart-js").length)return i.isTopMiniCart?n(["wcs.top-panel"],function(){i.initializeMinicartComponents(),i.updateContentEvents(),i.disableMiniCart||i.minicartUpdateShopcartEvents()}):(i.initializeMinicartComponents(),i.updateContentEvents(),i.disableMiniCart||i.minicartUpdateShopcartEvents()),i.events(),i},events:function(){r("body").on("click",this,this.miniCartGlobalClickHandler)},initializeMinicartComponents:function(){var t=this;t.isSmallScreen()?e.init():t.isTopMiniCart||n(["wcs.right-panel"],function(i){t.$globalCartWishlistPanels.rightPanels()})},showMinicartPanel:function(){var i=this;i.isSmallScreen()?(i.toggleOverlay(),i.$globalCartWishlistPanels.find(".notification").removeClass("hide"),i.$globalCartWishlistPanels.removeClass("hide"),i.isTopMiniCart||i.$globalCartWishlistPanels.show(),i.miniCartMobileTopScrollEnabled&&r("html,body").animate({scrollTop:0},"fast"),r.pubsub("publish","vfdp.wcs.minicart.mobile_notification_panel_opened")):(i.isTopMiniCart||i.$globalCartWishlistPanels.show(),i.$globalCartWishlistPanels.removeClass("hide"))},hideMinicartPanel:function(){var i=this;i.isSmallScreen()?(i.$globalCartWishlistPanels.find(".notification").addClass("hide"),i.isTopMiniCart?i.$globalCartWishlistPanels.addClass("hide"):i.$globalCartWishlistPanels.fadeOut(),i.toggleOverlay()):(i.isTopMiniCart||i.$globalCartWishlistPanels.hide(),i.$globalCartWishlistPanels.addClass("hide"))},getProductName:function(i){return i=i||{},Array.isArray(i.product)?i.product[0].name:"object"==typeof i.product&&"string"==typeof i.product.name?i.product.name:void 0},minicartUpdateShopcartEvents:function(){var a=this;r.pubsub("subscribe","SHOPCART_UPDATED",function(i,t){t=t||{};a.getProductName(t);if(a.isSmallScreen()){if(!e.shopcartUpdateCheck)return}else if("delete"===t.action)return void a.showRemoveItemMessage();a.isSmallScreen()&&(a.manuallyClosed=!1,clearTimeout(a.notificationTimer),a.showMinicartPanel(),r(a.$globalCartWishlistPanels).one("click",".mini-cart-icon-close-js",function(){a.isTopMiniCart?a.$globalCartWishlistPanels.addClass("hide"):a.$globalCartWishlistPanels.fadeOut(),a.toggleOverlay(!0)}),a.notificationTimer=setTimeout(function(){a.hideMinicartPanel()},a.autoHideTime))})},updateContentEvents:function(){var e=this;r.pubsub("subscribe","WISHLIST_UPDATED",function(i,t){"delete"===t?e.showRemoveItemMessage():e.isSmallScreen()&&(r(".notification",e.config.wishlistPanel),clearTimeout(e.notificationTimer),r(e.config.wishlistPanel).show())}),r.pubsub("subscribe","MINICART_CONTENT_RENDER_COMPLETE",function(i,t){var a=r(".reveal",e.$miniCartPanels);0<r("*[data-open]",e.$miniCartPanels).length&&a.each(function(i,t){var a=r(t);r("body > #"+a.attr("id")).length<=0&&r("body").append(a)}),r(".share-cart-js",e.$miniCartPanels).on("click",function(){r(".tags .active",e.$miniCartPanels).trigger("click")}),WCS_CONFIG.get("global::miniCartVisaCheckoutEnabled")&&r.pubsub("publish","VISA_CHECKOUT_CONTENT_READY"),0<r(".email-me-my-cart-form-container-js").length&&n(["wcs.email-me-my-cart"],function(){r(".email-me-my-cart-form-container-js").emailMeMyCart()}),0<r(".apple-pay-button").length&&n(["wcs.applepay-button"],function(){r(".apple-pay-button").applePay()})}),0<r(".email-me-my-cart-form-js").length&&e.isSmallScreen()&&r.pubsub("subscribe","ORDER_ID_UPDATED",function(i,t){r('.email-me-my-cart-email-only-form.email-me-my-cart-form-js input[name="orderId"]').val(t.orderId)}),r.pubsub("subscribe","EMAIL_ME_MY_CART_ACTION",function(){clearTimeout(e.notificationTimer)}),r.pubsub("subscribe","EMAIL_ME_MY_CART_FINISHED",function(){e.$globalCartWishlistPanels.find(".notification");autoHideTimer=setTimeout(function(){e.hideMinicartPanel()},e.autoHideTime)}),r.pubsub("subscribe","vfdp.wcs.free_gift.offer_loading",function(){r(".cart-js.mini-cart-tag-shopcart.active").trigger("click")}),r.pubsub("subscribe","vfdp.wcs.product_form.add_to_cart_succeeded",function(){"right"===e._miniCartLocation&&"small"!==a.size()&&r(".cart-js.mini-cart-tag-shopcart:not(.active)").trigger("click")}),r.pubsub("subscribe","vfdp.wcs.wishlist.add_to_cart_succeeded",function(){"right"===e._miniCartLocation&&"small"!==a.size()&&r(".cart-js.mini-cart-tag-shopcart:not(.active)").trigger("click")}),r.pubsub("subscribe","vfdp.wcs.free_gift.offer_complete",function(){"right"===e._miniCartLocation&&"small"!==a.size()&&r(".cart-js.mini-cart-tag-shopcart:not(.active)").trigger("click")})},showRemoveItemMessage:function(){var i=this,t=i.$globalCartWishlistPanels.find(".notification");"small"!==a.size()&&r(".minicart-sr-text-js").remove(),i.isTopMiniCart?(clearTimeout(i.notificationTimer),t.removeClass("hide")):t.addClass("show-for-sr").removeClass("hide")},toggleOverlay:function(i){r("#global-body-overlay").length<1&&r("header").append('<div id="global-body-overlay" title="Click to close"></div>');var t=this,a=r("#global-body-overlay");(t.mobileShowAsModal||t.isCMSTopNav)&&(t.manuallyClosed||(t.overlayVisible?a.fadeOut(500).delay(500).css({width:"0%"}):a.hide().css({width:"100%"}).fadeIn(500),i&&(t.manuallyClosed=!0),t.overlayVisible=!t.overlayVisible))},miniCartGlobalClickHandler:function(i){var t,a,e,n=i.data;if($target=r(i.target),"right"===n._miniCartLocation&&$target.hasClass("cart-js")&&$target.hasClass("active-js")||$target.parents().hasClass("cart-js")&&$target.parents().hasClass("active-js"))t=ACTION_URLS.MINI_SHOPPING_URL,a={storeId:d.getStoreId(),langId:d.getLangId(),catalogId:d.getCatalogId()},e={title:LANG_MSG["DEAFULT_MINICART.SHOPPING.title"],page:"shopcart",container:r(".global-cart-wishlist-panels-js .shopcart.cart-list")},c.renderMiniListItems(t,a,e);else if($target.hasClass("wishlist-js")&&$target.hasClass("active-js")||$target.parents().hasClass("wishlist-js")&&$target.parents().hasClass("active-js"))t=ACTION_URLS.MINI_WISHLIST_URL,a={storeId:d.getStoreId(),langId:d.getLangId()},e={title:LANG_MSG["DEAFULT_MINICART.WISHLIST.title"],page:"wishlist",container:r(".global-cart-wishlist-panels-js .wishlist.cart-list")},c.renderMiniListItems(t,a,e);else if(0<$target.parents(".remove-item-js").length){var s=$target.parents(".cart-item-js").find(".cart-item-row"),o="";s.find(".item-attr-js").each(function(){o+=(0<o.length?" / ":"")+r(this).text()});var l={currency:WCS_CONFIG.get("global::currencyCode"),productName:s.find(".item-name-js").text().replace(/^\s+|\s+$/gm,""),productId:s.find(".product-info-js").data("partNumber"),itemId:s.find(".product-info-js").data("itemPartnumber"),bundleId:s.find(".product-info-js").data("bundlePartnumber"),styleCode:s.find(".product-info-js").data("styleCode"),colorCode:s.find(".item-attr-info-js").data("colorCode"),colorDescription:s.find(".item-attr-info-js").data("colorDescription"),size:s.find(".item-attr-info-js").data("size"),unitPrice:s.find(".item-price-js").data("unitPrice"),definingAttributes:r.trim(o),quantity:s.find(".item-qty-js").data("qty"),isProductRemoval:!0};zm.trackRemovedItem(l)}},_build:function(){var i=this;i.isCMSTopNav&&!1===i._cmsTopNavRightMiniCart&&(r(i.config.rightMiniCartPanel).remove(),i._miniCartLocation="top",0===r(i.config.cmsTopNavMiniCart).length&&r(i.config.topnav).append('<section class="topnav-minicart"><div class="topnav-minicart-panel hide"><div class="topnav-minicart-notification notification hide"></div><div class="topnav-minicart-content content"><article class="topnav-minicart-content-container shopcart cart-list" data-tabcontent="shopcart"></article></div></div></section>'))}}).defaults,r.fn.minicart=function(t){return this.each(function(){var i=r(this).data(o);i||(i=new s(this,t).init(),r(this).data(o,i))})}});
//# sourceMappingURL=../../../maps/js/wcs/view/mini-cart.hash-e26f9cd1f455d3424357d3daca3834ec.js.map