define(["jquery","pubsub","jquery.hoverintent","shared.main.screen","wcs.utils"],function(w,e,o,t,s){var n,r=!1;return(n={defaults:{el:".topnav-mainnav",activeItem:".active",dataAttr:"topnav-more-dropdown-options",dropdownCloseButton:"topnav-mainnav-more-dropdown-close",dropdownWrapper:"topnav-mainnav-more-dropdown-wrapper",itemLink:".topnav-accordion-item-link",moreItem:".l1.topnav-list, .l1.more",moreLink:" > a",topnav:".topnav",moreDropdown:".topnav-dropdown-list, .topnav-mainnav-more-dropdown",moreDropdownClose:".topnav-mainnav-more-dropdown-close",moreDropdownL1s:".topnav-mainnav-more-menu .l1",moreMenu:".topnav-mainnav-more-menu",rateLimit:150,topNavNewHeader:".top-nav-header"},init:function(){var e=this;return e.deferred=w.Deferred(),e.$element=w(e.defaults.el),e.metadata=e.$element.data(e.defaults.dataAttr),e.config=w.extend({},e.defaults,e.metadata),e.config.$header=e.$element,e.config.$topnav=e.config.$header.closest(e.config.topnav),e.events(),e.keyPressCounterReset=0,e.keyPressCounter=e.keyPressCounterReset,e.menuStatus="inactive",e.config.$topnav.closest(".transperant-topnav").length&&(r=!0),e.deferred.resolve(),e},events:function(){var n=this,t=w(n.config.moreItem);w.pubsub("subscribe","window.resize.breakpoint",function(e,o){n.hideMoreDropdown(t)}),w.pubsub("subscribe","vfdp.aem.topnav.moreMenu.remove.list",function(e,o){n.bindDropdownMenuEvents(o)}),w.pubsub("subscribe","vfdp.aem.topnav.moreMenu.add.list",function(e,o){n.unbindDropdownMenuEvents(o)}),n.bindDropdownMenuEvents(t),t.find(n.config.moreDropdownClose).on("click touch",function(e){e.preventDefault(),e.stopPropagation();var o=w(this).closest(n.config.activeItem);n.hideMoreDropdown(o)}),w.pubsub("subscribe","vfdp.aem.topnav.moreMenu.updated",function(e,o){n.addTabIndexToDropdownElements()}),w.pubsub("subscribe","vfdp.aem.topnav.dropdown.opened",function(e,o){t.hasClass("active")&&n.hideMoreDropdown(t)})},unbindDropdownMenuEvents:function(e){e.off("mouseenter mouseleave"),e.find(this.config.moreLink).off("tap"),e.off("keydown")},bindDropdownMenuEvents:function(e){var n=this;e.find(n.config.moreLink).on("tap",function(e){if("small"!==t.size()){e.preventDefault();var o=w(this).closest(n.config.moreItem);o.hasClass("active")?n.animateMoreClosed(o):n.animateMoreOpen(o)}}),e.hoverIntent({over:function(){"small"!==t.size()&&n.animateMoreOpen(w(this))},out:function(e){"small"!==t.size()&&n.hideMoreDropdown(w(this))},timeout:n.config.rateLimit}),e.on("keydown",n,n.topnavMoreMenuKeyDownHandler)},addTabIndexToDropdownElements:function(){for(var e=w(".topnav-mainnav-more-dropdown .l1 > a"),o=0;o<e.length;o++)w(e[o]).attr("tabindex",o+1)},calculateMoreDropdownPosition:function(e,o){var n=e.offset(),t=e.outerWidth(),r=o.outerWidth(),i=n.left-r/2+t/2,a=w(window).outerWidth();return(i=Math.min(i,a-r))<0&&(i=0),i},hideMoreDropdown:function(e){var o=this,n=e.find(o.config.moreLink),t=e.find(o.config.moreDropdown);n.attr({"aria-expanded":"false"}),s.interruptTransitions(t,function(){e.removeClass("active"),o.moreToggleTransperantTopNav("hide"),t.css({display:"",height:""})}),w("body").off("click touchstart scroll scrollstart",o.handleDismissMoreDropdown),w.pubsub("publish","vfdp.aem.topnav.moreDropdown.closed")},showMoreDropdown:function(e){var o=this,n=e.find(o.config.moreLink),t=e.find(o.config.moreDropdown);e.addClass("active"),n.attr({"aria-expanded":"true"}),t.css("left",o.calculateMoreDropdownPosition(n,t)),w("body").on("click touchstart scroll scrollstart",o,o.handleDismissMoreDropdown),w.pubsub("publish","vfdp.aem.topnav.moreDropdown.opened")},animateMoreOpen:function(e){var o,n,t=this,r=e.find(t.config.moreLink),i=e.find(t.config.moreDropdown);if(r.attr({"aria-expanded":"true"}),!e.hasClass("active")){o=i[0].style.transition,i[0].style.transition="",e.addClass("active"),i.css({display:"block",height:"0"}),i[0].style.transition=o,n=i[0].scrollHeight,i.css("left",t.calculateMoreDropdownPosition(r,i)),t.moreToggleTransperantTopNav("show");var a=function(){i[0].style.height="",i[0].removeEventListener("transitionend",a)};i[0].addEventListener("transitionend",a),s.interruptTransitions(i,function(){i[0].style.height=n+"px"}),w.pubsub("publish","vfdp.aem.topnav.moreDropdown.opened")}w("body").on("click touchstart scroll scrollstart",t,t.handleDismissMoreDropdown)},moreToggleTransperantTopNav:function(e){if(r){var o=w(this.config.topNavNewHeader);"show"==e?o.addClass("new-transperant-topnav"):o.removeClass("new-transperant-topnav")}},animateMoreClosed:function(e){var o,n,t=this,r=e.find(t.config.moreLink),i=e.find(t.config.moreDropdown);r.attr({"aria-expanded":"false"}),o=i[0].scrollHeight,n=i[0].style.transition,i[0].style.transition="",t.moreToggleTransperantTopNav("hide");var a=function(){i[0].style.display="",i[0].style.height="",i.closest(".l1").removeClass("active"),t.moreToggleTransperantTopNav("hide"),i[0].removeEventListener("transitionend",a)};requestAnimationFrame(function(){s.interruptTransitions(i,function(){i[0].style.height=o+"px",i[0].style.transition=n}),requestAnimationFrame(function(){i[0].addEventListener("transitionend",a),i[0].style.height="0px"})}),w("body").off("click touchstart scroll scrollstart",t.handleDismissMoreDropdown)},handleDismissMoreDropdown:function(e){var o=e.data;w(e.target).closest(o.config.moreItem).length||w(e.target).closest(o.config.moreDropdown).length||o.hideMoreDropdown(w(o.config.moreItem))},topnavMoreMenuKeyDownHandler:function(e){var o,n,t=e.data,r=w(this),i=r.find(w(":focus")),a=i.parent(),s=a.closest("."+t.config.dropdownWrapper),d=a.hasClass("more")||a.hasClass("topnav-list"),l=40,p=13,c=27,f=37,u=39,m=32,v=9,h=38;switch(e.keyCode){case p:case m:d?(e.preventDefault(),a.hasClass("active")?t.hideMoreDropdown(r):(t.showMoreDropdown(r),a.find("."+t.config.dropdownCloseButton).focus())):i.hasClass(t.config.dropdownCloseButton)&&(e.preventDefault(),t.hideMoreDropdown(r),i.closest(".more").find(t.config.moreLink).focus());break;case v:i.hasClass(t.config.dropdownCloseButton)&&(e.preventDefault(),s.find(t.config.itemLink).first().focus());break;case l:e.preventDefault(),d?(t.showMoreDropdown(r),a.find("."+t.config.dropdownCloseButton).focus()):i.hasClass(t.config.dropdownCloseButton)?s.find(t.config.itemLink).first().focus():((o=a.next().find("> a")).length||(o=s.find(t.config.itemLink).first()),o.focus());break;case h:e.preventDefault(),!d&&a.hasClass("l1")&&((o=a.prev().find("> a")).length||(o=s.find(t.config.itemLink+":visible").last()),o.focus());break;case u:d&&((o=a.next().find("> a")).length||(o=t.$element.find(".l1").first().find("> a")),o.focus());break;case f:d&&((n=a.prev().find("> a")).length||(n=t.$element.find(".l1").last().find("> a")),n.focus());break;case c:s.closest(".l1").hasClass("active")&&(e.preventDefault(),t.hideMoreDropdown(r),i.closest(".more").find(t.config.moreLink).focus())}}}).init(),n});
//# sourceMappingURL=../../../maps/js/cms/nav/moreDropdown.hash-8e74f50c958eb70280259b4eabf1a30d.js.map